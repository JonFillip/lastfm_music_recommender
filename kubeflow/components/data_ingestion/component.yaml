name: Data Ingestion
description: Fetches top tracks data from Last.fm API

inputs:
  - {name: limit, type: Integer, default: "5000", description: 'Number of tracks to fetch'}

outputs:
  - {name: output_dataset, type: Dataset, description: 'Output dataset containing fetched tracks'}
  - {name: num_tracks, type: Integer, description: 'Number of tracks fetched'}

implementation:
  container:
    image: python:3.9
    command:
      - python
      - -c
      - |
        from kubeflow.components.data_ingestion.data_ingestion import data_ingestion
        import argparse

        parser = argparse.ArgumentParser(description='Data ingestion component for Kubeflow')
        parser.add_argument('--limit', type=int, default=5000)
        parser.add_argument('--output_dataset', type=str)
        args = parser.parse_args()

        outputs = data_ingestion(output_path=args.output_dataset, limit=args.limit)
        
        print(f"Number of tracks fetched: {outputs.num_tracks}")

        # Write output
        with open('/tmp/num_tracks.txt', 'w') as f:
            f.write(str(outputs.num_tracks))

    args:
      - --limit
      - {inputValue: limit}
      - --output_dataset
      - {outputPath: output_dataset}
      - --num_tracks
      - {outputPath: num_tracks}